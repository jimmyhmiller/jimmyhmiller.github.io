<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="data:;base64,iVBORw0KGgo="/><meta name="author" content="Jimmy Miller"/><link rel="alternate" type="application/rss+xml" title="jimmyhmiller.github.io" href="feed.xml"/><title>Named Function Composition</title><meta name="next-head-count" content="6"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-779b41245c009d2a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9a4e0bcfd9f9bf48.js" defer=""></script><script src="/_next/static/chunks/346-54adb587a188464b.js" defer=""></script><script src="/_next/static/chunks/854-585071c317c86ef6.js" defer=""></script><script src="/_next/static/chunks/pages/named-function-composition-c1ebc800c0065fd5.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_buildManifest.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_ssgManifest.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_middlewareManifest.js" defer=""></script><style id="__jsx-4dc580444c2ee173">body{font-family:helvetica,sans-serif;color:#333;line-height:1.5}a{color:#333}</style></head><body><div id="__next" data-reactroot=""><div style="margin:0 auto;max-width:700px"><div style="position:relative"><div style="position:absolute;right:0;top:0"><a style="text-decoration:none" href="/"><h1 style="color:#999">Jimmy Miller</h1></a></div></div><div style="padding-top:70px"><h1>Named Function Composition</h1><p>Some time ago I release a little library on NPM called<!-- --> <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">fluent-compose</code>. I&#x27;ve had some mixed feelings about my creation. I know that no one has, or will use it and if they looked at it would probably dismiss it. In fact, if I hadn&#x27;t written it, I would do the same. And yet, I think I&#x27;ve stumbled onto a fairly decent idea. By decent idea, I mean a hack. But before we dive into this hack, let&#x27;s look at the situation that gave rise to it.</p><p>There is this fantastic, little known library called<!-- --> <a href="https://zaphod.surge.sh/">Zaphod</a>. The idea behind Zaphod is to mirror Clojure&#x27;s immutable data API. This makes it incredibly simple to do immutable updates on plain javascript objects.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">import</span> <span class="token" style="color:#586e75">{</span> update<span class="token" style="color:#586e75">,</span> inc <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">from</span> <span class="token" style="color:#2aa198">&#x27;zaphod/compat&#x27;</span><span class="token" style="color:#586e75">;</span>
<span class="token" style="color:#859900">const</span> state <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">{</span> count<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">0</span> <span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">;</span>
<span class="token" style="color:#b58900">update</span><span class="token" style="color:#586e75">(</span>state<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#2aa198">&#x27;count&#x27;</span><span class="token" style="color:#586e75">,</span> inc<span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// { count : 1}</span>
</code></pre><p>The way I&#x27;ve written the code above is actually not the default way Zaphod works. I imported the <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">compat</code> part of zaphod. By default, the functions are exposed to take advantage of the function bind operator<!-- --> <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">::</code>.<!-- --> </p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">import</span> <span class="token" style="color:#586e75">{</span> update<span class="token" style="color:#586e75">,</span> inc<span class="token" style="color:#586e75">,</span> dec <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">from</span> <span class="token" style="color:#2aa198">&#x27;zaphod&#x27;</span><span class="token" style="color:#586e75">;</span>
<span class="token" style="color:#859900">const</span> state <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">{</span> count<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">,</span> otherCount<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">0</span> <span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">;</span>
state<span class="token" style="color:#586e75">:</span><span class="token" style="color:#586e75">:</span><span class="token" style="color:#b58900">update</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#2aa198">&#x27;count&#x27;</span><span class="token" style="color:#586e75">,</span> inc<span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// { count : 1}</span>

state
    <span class="token" style="color:#586e75">:</span><span class="token" style="color:#586e75">:</span><span class="token" style="color:#b58900">update</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#2aa198">&#x27;count&#x27;</span><span class="token" style="color:#586e75">,</span> inc<span class="token" style="color:#586e75">)</span>
    <span class="token" style="color:#586e75">:</span><span class="token" style="color:#586e75">:</span><span class="token" style="color:#b58900">update</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#2aa198">&#x27;otherCount&#x27;</span><span class="token" style="color:#586e75">,</span> dec<span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#93a1a1">// {count: 1, otherCount: -1}</span>
</code></pre><p>This is actually some really neat functionality. It allows you to chain your operators together. We can build pipelines by continuing to bind. Unfortunately, we don&#x27;t get function bind syntax for free. Function bind is still a stage 0 proposal. This means there is a very good possibility it will never make it into javascript. In fact, after a few years of sitting at stage 0, it is basically considered dead. There is quite a lot of risk involved in using it and more conservative configurations like<!-- --> <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">create-react-app</code> wouldn&#x27;t use it.</p><p>But function bind syntax also has flaws even if it were accepted into the language. Function bind syntax abuses <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">this</code> the most misunderstood keyword in all of javascript. The functions you write with function binding in mind must use <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">this</code>, they can&#x27;t be normal functions. Of course, you can wrap up those functions, but if we need to wrap functions up, why not wrap them in a way that doesn&#x27;t require function bind?</p><p>This is where <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">fluent-compose</code> comes in. Let&#x27;s look at an example.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">import</span> <span class="token" style="color:#cb4b16">*</span> <span class="token" style="color:#859900">as</span> zaphod<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">{</span> update <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">from</span> <span class="token" style="color:#2aa198">&#x27;zaphod/compat&#x27;</span><span class="token" style="color:#586e75">;</span>
<span class="token" style="color:#859900">import</span> <span class="token" style="color:#586e75">{</span> threadFirst<span class="token" style="color:#586e75">,</span> fluentCompose <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">from</span> <span class="token" style="color:#2aa198">&#x27;fluent-compose&#x27;</span><span class="token" style="color:#586e75">;</span>

<span class="token" style="color:#859900">const</span> transform <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#b58900">fluentCompose</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">threadFirst</span><span class="token" style="color:#586e75">(</span>zaphod<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>

<span class="token" style="color:#859900">const</span> transformer <span class="token" style="color:#cb4b16">=</span> transform
    <span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">update</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#2aa198">&#x27;count&#x27;</span><span class="token" style="color:#586e75">,</span> inc<span class="token" style="color:#586e75">)</span>
    <span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">update</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#2aa198">&#x27;otherCount&#x27;</span><span class="token" style="color:#586e75">,</span> dec<span class="token" style="color:#586e75">)</span>
    <span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">set</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#2aa198">&#x27;anotherCounter&#x27;</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#b58900">transformer</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">{</span>count<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">,</span> otherCount<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">,</span> anotherCounter<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#93a1a1">// {count: 1, otherCount: -1, anotherCounter: 2}</span>

<span class="token" style="color:#b58900">update</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">{</span> counters<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">{</span>count<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">,</span> otherCount<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#2aa198">&#x27;counters&#x27;</span><span class="token" style="color:#586e75">,</span> transformer<span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#93a1a1">// {counters: {count: 1, otherCount: -1, anotherCounter: 2}}</span>
</code></pre><p>Here we see the <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">threadFirst</code> function in use. This allows us to take a collection of functions, in this case <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">zaphod</code>, and wrap them up into a fluent interface. But what does this fluent interface do? It is just function composition. After calling it, we get a function back. We can now use this function to pass our data through the pipeline. Since what we get back is just a function, we can also pass this function around. We can see its use on line 14 as just a normal function that lets us perform a series of transformations on data.</p><p>This is a fairly simple use of <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">fluent-compose</code>, let&#x27;s take it one step further.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">import</span> <span class="token" style="color:#cb4b16">*</span> <span class="token" style="color:#859900">as</span> zaphod <span class="token" style="color:#859900">from</span> <span class="token" style="color:#2aa198">&#x27;zaphod/compat&#x27;</span><span class="token" style="color:#586e75">;</span>
<span class="token" style="color:#859900">import</span> <span class="token" style="color:#cb4b16">*</span> <span class="token" style="color:#859900">as</span> lodashFpCollection <span class="token" style="color:#859900">from</span> <span class="token" style="color:#2aa198">&#x27;lodash/fp/collection&#x27;</span><span class="token" style="color:#586e75">;</span>
<span class="token" style="color:#859900">import</span> <span class="token" style="color:#586e75">{</span> threadFirst<span class="token" style="color:#586e75">,</span> threadLast<span class="token" style="color:#586e75">,</span> fluentCompose <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">from</span> <span class="token" style="color:#2aa198">&#x27;fluent-compose&#x27;</span><span class="token" style="color:#586e75">;</span>

<span class="token" style="color:#859900">const</span> zaphodTransform <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#b58900">threadFirst</span><span class="token" style="color:#586e75">(</span>zaphod<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>
<span class="token" style="color:#859900">const</span> lodashTransform <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#b58900">threadLast</span><span class="token" style="color:#586e75">(</span>lodashFpCollection<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>

<span class="token" style="color:#859900">const</span> transform <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#b58900">fluentCompose</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">{</span>
  <span class="token" style="color:#cb4b16">...</span>zaphodTransform<span class="token" style="color:#586e75">,</span>
  <span class="token" style="color:#cb4b16">...</span>lodashTransform<span class="token" style="color:#586e75">,</span>
<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#859900">const</span> transformer <span class="token" style="color:#cb4b16">=</span> transform
  <span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span><span class="token parameter">x</span> <span class="token" style="color:#cb4b16">=&gt;</span> x <span class="token" style="color:#cb4b16">+</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">filter</span><span class="token" style="color:#586e75">(</span><span class="token parameter">x</span> <span class="token" style="color:#cb4b16">=&gt;</span> x <span class="token" style="color:#cb4b16">%</span> <span class="token" style="color:#268bd2">2</span> <span class="token" style="color:#cb4b16">===</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">set</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#268bd2">3</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#b58900">transformer</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">[</span><span class="token" style="color:#268bd2">1</span><span class="token" style="color:#586e75">,</span><span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">,</span><span class="token" style="color:#268bd2">3</span><span class="token" style="color:#586e75">,</span><span class="token" style="color:#268bd2">4</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// [3, 6]</span>
</code></pre><p>Here we can see a combination of two totally separate libraries. In fact, I even used <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">lodash/fp</code> because rather than taking its primary argument first, it makes it last. Yet, we were still able to compose these libraries in a simple, yet flexible way.<!-- --> </p><p>Yet, <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">fluent-compose</code> holds still more power. This time, we will be using some of the lower level features of <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">fluent-compose</code>, explaining them here would be beyond the scope of this post.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">import</span> <span class="token" style="color:#586e75">{</span> fluentCompose <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">from</span> <span class="token" style="color:#2aa198">&#x27;fluent-compose&#x27;</span><span class="token" style="color:#586e75">;</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">baseReducer</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">state<span class="token" style="color:#586e75">,</span> action</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> state<span class="token" style="color:#586e75">;</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">initialState</span> <span class="token" style="color:#cb4b16">=</span> <span class="token parameter">prev</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token parameter">init</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">state<span class="token" style="color:#586e75">,</span> action</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span>
  <span class="token" style="color:#b58900">prev</span><span class="token" style="color:#586e75">(</span>state <span class="token" style="color:#cb4b16">||</span> init<span class="token" style="color:#586e75">,</span> action<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">reduce</span> <span class="token" style="color:#cb4b16">=</span> <span class="token parameter">prev</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">type<span class="token" style="color:#586e75">,</span> f</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">state<span class="token" style="color:#586e75">,</span> action</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
  <span class="token" style="color:#859900">if</span> <span class="token" style="color:#586e75">(</span>action <span class="token" style="color:#cb4b16">&amp;&amp;</span> action<span class="token" style="color:#586e75">.</span>type <span class="token" style="color:#cb4b16">===</span> type<span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#859900">return</span> <span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span>state<span class="token" style="color:#586e75">,</span> action<span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">}</span>
  <span class="token" style="color:#859900">return</span> <span class="token" style="color:#b58900">prev</span><span class="token" style="color:#586e75">(</span>state<span class="token" style="color:#586e75">,</span> action<span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#586e75">}</span>

<span class="token" style="color:#859900">const</span> <span class="token" style="color:#268bd2">INCREMENT</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#2aa198">&#x27;INCREMENT&#x27;</span><span class="token" style="color:#586e75">;</span>
<span class="token" style="color:#859900">const</span> <span class="token" style="color:#268bd2">DECREMENT</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#2aa198">&#x27;DECREMENT&#x27;</span><span class="token" style="color:#586e75">;</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">increment</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">{</span>
  type<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">INCREMENT</span>
<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">decrement</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">{</span>
  type<span class="token" style="color:#586e75">:</span> <span class="token" style="color:#268bd2">DECREMENT</span>
<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#859900">const</span> reducer <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#b58900">fluentCompose</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">{</span> initialState<span class="token" style="color:#586e75">,</span> reduce <span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">,</span> baseReducer<span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#859900">const</span> counter <span class="token" style="color:#cb4b16">=</span> reducer
  <span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">initialState</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">reduce</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#268bd2">INCREMENT</span><span class="token" style="color:#586e75">,</span> <span class="token parameter">x</span> <span class="token" style="color:#cb4b16">=&gt;</span> x <span class="token" style="color:#cb4b16">+</span> <span class="token" style="color:#268bd2">1</span><span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">reduce</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#268bd2">DECREMENT</span><span class="token" style="color:#586e75">,</span> <span class="token parameter">x</span> <span class="token" style="color:#cb4b16">=&gt;</span> x <span class="token" style="color:#cb4b16">-</span> <span class="token" style="color:#268bd2">1</span><span class="token" style="color:#586e75">)</span>

console<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">log</span><span class="token" style="color:#586e75">(</span>
  <span class="token" style="color:#b58900">counter</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">increment</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#586e75">)</span>
</code></pre><p>Using <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">fluent-compose</code> we&#x27;ve made a fluent reducer for redux! No longer would we need to write switch statements in order to make a reducer. In fact, since <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">fluent-compose</code> just makes functions, you can use this reducer with combine reducers. But another really cool thing you can do with it is add on the reducer after the fact. One feature to note with this implementation is that it actually short circuits, as soon as it finds the action that matches the type, it returns, so there is no wasted computation.</p><h2>Why do I call this a hack?</h2><p>I really do think this library is really useful, but at the same time, I can&#x27;t help but feel a little weird about this library. In order to make this library work, I have to take advantage of the fact that functions are objects. I am making a function and then assigning methods to it. This definitely a strange thing to do. Now, I do avoid mutating the functions passed into, I &quot;copy&quot; them before I assign properties to them, but it still feels like the wrong means for accomplishing the task of creating a pipeline.</p><p>In fact, that is the thing that makes this library a hack; it is the wrong means. This library was created out of the limitation javascript imposes on us. How would we accomplish similar things in other languages? Here are just a couple of examples.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#93a1a1">;; Clojure</span>
<span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">-&gt;&gt;</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">range</span> <span class="token" style="color:#268bd2">100</span><span class="token" style="color:#586e75">)</span>
     <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">map</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">partial</span> <span class="token" style="color:#859900">+</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
     <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">filter</span> even?<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#93a1a1">-- Haskell</span>
<span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">|&gt;</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">::</span> <span class="token hvariable">a</span> <span class="token" style="color:#cb4b16">-&gt;</span> <span class="token" style="color:#586e75">(</span><span class="token hvariable">a</span> <span class="token" style="color:#cb4b16">-&gt;</span> <span class="token hvariable">b</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">-&gt;</span> <span class="token hvariable">b</span>
<span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">|&gt;</span><span class="token" style="color:#586e75">)</span> <span class="token hvariable">a</span> <span class="token hvariable">f</span> <span class="token" style="color:#cb4b16">=</span> <span class="token hvariable">f</span> <span class="token hvariable">a</span>

<span class="token" style="color:#2aa198">range</span> <span class="token" style="color:#268bd2">100</span>
<span class="token" style="color:#cb4b16">|&gt;</span> <span class="token" style="color:#2aa198">map</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">+</span><span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#cb4b16">|&gt;</span> <span class="token" style="color:#2aa198">filter</span> <span class="token" style="color:#2aa198">even</span>
</code></pre><p>Above we see how we could accomplish similar things in Haskell and Clojure. Almost all functional programming languages have a way to do this. In fact, there are some much more powerful techniques for function composition in both Haskell and Clojure.</p><h3>Still interesting</h3><p>At the same time, this method has some interesting features all on its own. What we have done is allow our functions to have special ways in which they compose. Each function can determine for itself special composition points. At each point along the way, we keep these composition properties, allowing us to compose further. Each of these composition methods has a name, hence &quot;named function composition&quot;. While born out of necessity an implemented as a hack, there is something here, something interesting that might be worth exploring further. (Addendum: It has been two years and I&#x27;ve yet to explore it further.)</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/named-function-composition","query":{},"buildId":"NkSpooCu6BjZSpPPrzhqj","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>