<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="data:;base64,iVBORw0KGgo="/><meta name="author" content="Jimmy Miller"/><link rel="alternate" type="application/rss+xml" title="jimmyhmiller.github.io" href="feed.xml"/><title>Variants and Protocols</title><meta name="next-head-count" content="6"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-779b41245c009d2a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9a4e0bcfd9f9bf48.js" defer=""></script><script src="/_next/static/chunks/346-54adb587a188464b.js" defer=""></script><script src="/_next/static/chunks/854-585071c317c86ef6.js" defer=""></script><script src="/_next/static/chunks/pages/variants-and-protocols-bddaa4fd0fae037c.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_buildManifest.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_ssgManifest.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_middlewareManifest.js" defer=""></script><style id="__jsx-4dc580444c2ee173">body{font-family:helvetica,sans-serif;color:#333;line-height:1.5}a{color:#333}</style></head><body><div id="__next" data-reactroot=""><div style="margin:0 auto;max-width:700px"><div style="position:relative"><div style="position:absolute;right:0;top:0"><a style="text-decoration:none" href="/"><h1 style="color:#999">Jimmy Miller</h1></a></div></div><div style="padding-top:70px"><h1>Variants and Protocols</h1><p>In our last post, we explored variants and the way in which they allow us to express choice. We saw that variants are much more powerful than enums because they allow you to pass values. Pattern matching on variants allows code to be explicit yet concise. However, there is still a way to make variants even more powerful, the ability to write functions that apply to multiple types of variants.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">data</span> <span class="token" style="color:#268bd2">Maybe</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#268bd2">Nothing</span> <span class="token" style="color:#cb4b16">|</span> <span class="token" style="color:#268bd2">Something</span><span class="token" style="color:#586e75">(</span><span class="token hvariable">thing</span><span class="token" style="color:#586e75">)</span>
</code></pre><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">fn map <span class="token" style="color:#586e75">{</span>
  <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">Something</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span></span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Something</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> Nothing</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> Nothing
<span class="token" style="color:#586e75">}</span>
</code></pre><p>Above is our definition of the Maybe variant and its associated function, map. Just as map for a list applies a function to every element in the list, map for Maybe applies the function if there is an element. But if we defined map as we do above, it would conflict with the definition of List because they have the same name. We could just move each map definition into a module, but then we lose some of the benefits behind map. To see what that is, let&#x27;s explore some different structures that work with map.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">data</span> <span class="token" style="color:#268bd2">Either</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#268bd2">Error</span><span class="token" style="color:#586e75">(</span><span class="token hvariable">e</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">|</span> <span class="token" style="color:#268bd2">Success</span><span class="token" style="color:#586e75">(</span><span class="token hvariable">x</span><span class="token" style="color:#586e75">)</span>
</code></pre><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">fn map <span class="token" style="color:#586e75">{</span>
  <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">Error</span><span class="token" style="color:#586e75">(</span>e<span class="token" style="color:#586e75">)</span></span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Error</span><span class="token" style="color:#586e75">(</span>e<span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">Success</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span></span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Success</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#586e75">}</span>
</code></pre><p>This is our first example, the Either Variant. Either allow us to have a value that is either a success or an error. If we have a success, then we want to apply our function to the successful value. If we have an error, applying a function wouldn&#x27;t make much sense.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">data</span> <span class="token" style="color:#268bd2">List</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#268bd2">Nil</span> <span class="token" style="color:#cb4b16">|</span> <span class="token" style="color:#268bd2">Cons</span><span class="token" style="color:#586e75">(</span><span class="token hvariable">x</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#2aa198">tail</span><span class="token" style="color:#586e75">)</span>
</code></pre><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">fn map <span class="token" style="color:#586e75">{</span>
  <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> Nil</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Nil</span>
  <span class="token" style="color:#586e75">(</span>f<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">(</span><span class="token parameter"><span class="token" style="color:#b58900">Cons</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">,</span> tail<span class="token" style="color:#586e75">)</span></span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Cons</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span>f<span class="token" style="color:#586e75">,</span> tail<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#586e75">}</span>
</code></pre><p>Here is actually the map you are probably most familiar with, mapping over a list. And yet I&#x27;m sure this definition is new for many of you. List here is our own custom list instead of the Array from javascript. This list is a linked list, and sticking with the naming convention used for a long time, each link is built up using a constructor called <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">Cons</code>. In order to map over our list, we apply it to the first element and recurse over the rest of the list.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">data</span> <span class="token" style="color:#268bd2">Tree</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#268bd2">Leaf</span><span class="token" style="color:#586e75">(</span><span class="token hvariable">x</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">|</span> <span class="token" style="color:#268bd2">Node</span><span class="token" style="color:#586e75">(</span><span class="token hvariable">left</span><span class="token" style="color:#586e75">,</span> <span class="token hvariable">x</span><span class="token" style="color:#586e75">,</span> <span class="token hvariable">right</span><span class="token" style="color:#586e75">)</span>
</code></pre><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">fn map <span class="token" style="color:#586e75">{</span>
  <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">Leaf</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span></span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Leaf</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">Node</span><span class="token" style="color:#586e75">(</span>left<span class="token" style="color:#586e75">,</span> x<span class="token" style="color:#586e75">,</span> right<span class="token" style="color:#586e75">)</span></span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Node</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span>f<span class="token" style="color:#586e75">,</span> left<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span>f<span class="token" style="color:#586e75">,</span> right<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#586e75">}</span>
</code></pre><p>Here we have a representation of a Tree. Mapping over a tree acts almost exactly like lists, a function is applied to every element, but with trees the structure is branched, so recursion needs to happen on both sides.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">data</span> <span class="token" style="color:#268bd2">Identity</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#268bd2">Id</span><span class="token" style="color:#586e75">(</span><span class="token hvariable">x</span><span class="token" style="color:#586e75">)</span>
</code></pre><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">fn map <span class="token" style="color:#586e75">{</span>
  <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">Id</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span></span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Id</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#586e75">}</span>
</code></pre><p>This is the Identity variant. It has a completely trivial map function. We take out the x and apply f to it and then wrap it back up. This may seem pointless (there are uses), but it does show yet another use of map.</p><h1>Unifying map</h1><p>Now that we&#x27;ve seen just some of the instances of how we could use map, it seems clear that just putting this in separate modules will lead to ugly code. We will have to refer to map using fully qualified names (e.g. Maybe.map, Either.map), this makes our code verbose, but also limits its reusability. As far as map is concerned, we shouldn&#x27;t care if we have Maybe, Either, or Identity, as long as we have an implementation of map. In other words, we want map to be a polymorphic function.</p><p>Protocols allow us to do exactly that, write functions that are polymorphic over a given datatype. When we pass a datatype to a function implemented as a protocol, it finds its type and dispatches to the proper function. Let&#x27;s look at the Mapper protocol.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">protocol Mapper <span class="token" style="color:#586e75">{</span>
  fn <span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span><span class="token parameter">x<span class="token" style="color:#586e75">,</span> f</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#2aa198">&quot;&quot;</span><span class="token" style="color:#2aa198">&quot;maps f over x&quot;</span><span class="token" style="color:#2aa198">&quot;&quot;</span>
  <span class="token" style="color:#586e75">}</span>
<span class="token" style="color:#586e75">}</span>

implement <span class="token" style="color:#b58900">Mapper</span><span class="token" style="color:#586e75">(</span><span class="token parameter">Maybe</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
  fn map <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#586e75">(</span><span class="token parameter"><span class="token" style="color:#b58900">Something</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span> f</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Something</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
    <span class="token" style="color:#586e75">(</span><span class="token parameter">Nothing<span class="token" style="color:#586e75">,</span> f</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> Nothing
  <span class="token" style="color:#586e75">}</span>
<span class="token" style="color:#586e75">}</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">map</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> x</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> Mapper<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">,</span> f<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>
</code></pre><p>Here is our first protocol, the Mapper protocol. Mapper is simple, in order to implement the Mapper protocol, you need to define map. One thing to note, however, is that our definition in the protocol does differ from our definitions before by one small detail, the arguments are flipped. Protocols require the type they are going to dispatch on to be the first argument. That is why we define a simple auxiliary function that flips them back around.</p><p>Now that we&#x27;ve made our protocol and defined an implementation for Maybe, we can use it on any maybe values.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span><span class="token parameter">x</span> <span class="token" style="color:#cb4b16">=&gt;</span> x <span class="token" style="color:#cb4b16">+</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">Something</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// Something(4)</span>
<span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span><span class="token parameter">x</span> <span class="token" style="color:#cb4b16">=&gt;</span> x <span class="token" style="color:#cb4b16">+</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">,</span> Nothing<span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// Nothing</span>
</code></pre><p>What is special about this version of map is that as long as we define a Mapper implementation for a variant, we can pass a value of that variant to the map function and it will work.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">implement <span class="token" style="color:#b58900">Mapper</span><span class="token" style="color:#586e75">(</span><span class="token parameter">Either</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
  fn map <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#586e75">(</span><span class="token parameter"><span class="token" style="color:#b58900">Error</span><span class="token" style="color:#586e75">(</span>e<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span> f</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Error</span><span class="token" style="color:#586e75">(</span>e<span class="token" style="color:#586e75">)</span>
    <span class="token" style="color:#586e75">(</span><span class="token parameter"><span class="token" style="color:#b58900">Success</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span> f</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">Success</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">}</span>
<span class="token" style="color:#586e75">}</span>

<span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span><span class="token parameter">x</span> <span class="token" style="color:#cb4b16">=&gt;</span> x <span class="token" style="color:#cb4b16">+</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">Error</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#2aa198">&quot;error&quot;</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// Error(&quot;error&quot;)</span>
<span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span><span class="token parameter">x</span> <span class="token" style="color:#cb4b16">=&gt;</span> x <span class="token" style="color:#cb4b16">+</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">Success</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// Success(4)</span>
</code></pre><p>We can see that our map does the right thing when passed a Maybe or an Either. This is a feature with no direct counterpart in javascript. Protocols allow us to extend functionality to new data types, they allow us to build common interfaces with which we can interact, and they allow this without a nested class hierarchy or any sort of monkey patching. Protocols offer a clean way to extend functionality through out our programs. They give us a way to add new capabilities to a library as well as to use old functions in new ways.</p><h1>Conclusion</h1><p>We have only seen a tiny glimpse into what protocols can do for us. The real power behind protocols comes when we group multiple fns together in a protocol and then build new functions that depend on that protocol. That may sound a bit abstract, but in our next post, we will dive in and implement a lodash like library that works on both built-in javascript data-structures and ImmutableJs data-structures all powered by protocols.</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/variants-and-protocols","query":{},"buildId":"NkSpooCu6BjZSpPPrzhqj","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>