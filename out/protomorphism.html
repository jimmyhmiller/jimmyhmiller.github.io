<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="data:;base64,iVBORw0KGgo="/><meta name="author" content="Jimmy Miller"/><link rel="alternate" type="application/rss+xml" title="jimmyhmiller.github.io" href="feed.xml"/><title>Protomorphism</title><meta name="next-head-count" content="6"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-779b41245c009d2a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9a4e0bcfd9f9bf48.js" defer=""></script><script src="/_next/static/chunks/346-54adb587a188464b.js" defer=""></script><script src="/_next/static/chunks/854-585071c317c86ef6.js" defer=""></script><script src="/_next/static/chunks/pages/protomorphism-9693c959e65790bd.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_buildManifest.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_ssgManifest.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_middlewareManifest.js" defer=""></script><style id="__jsx-4dc580444c2ee173">body{font-family:helvetica,sans-serif;color:#333;line-height:1.5}a{color:#333}</style></head><body><div id="__next" data-reactroot=""><div style="margin:0 auto;max-width:700px"><div style="position:relative"><div style="position:absolute;right:0;top:0"><a style="text-decoration:none" href="/"><h1 style="color:#999">Jimmy Miller</h1></a></div></div><div style="padding-top:70px"><h1>Protomorphism</h1><p>The last two posts ventured off into the hypothetical world. In that world, we had a language very much like javascript but with variants and protocols. Unfortunately, that language isn&#x27;t real, but that doesn&#x27;t mean we can&#x27;t sneak some of those ideas into our javascript. Today we are going to explore protocols further using a library called <a href="https://github.com/airportyh/protomorphism">Protomorphism</a> that adds protocols into javascript.<!-- --> </p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">import</span> protocol <span class="token" style="color:#859900">from</span> <span class="token" style="color:#2aa198">&#x27;protomorphism&#x27;</span>

<span class="token" style="color:#859900">const</span> Mapper <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#b58900">protocol</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">{</span>
  <span class="token function-variable" style="color:#b58900">map</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">x<span class="token" style="color:#586e75">,</span> f</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
   <span class="token" style="color:#93a1a1">// maps f over x</span>
  <span class="token" style="color:#586e75">}</span>
<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>

Mapper<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">implementation</span><span class="token" style="color:#586e75">(</span>Array<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">{</span>
  <span class="token function-variable" style="color:#b58900">map</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">arr<span class="token" style="color:#586e75">,</span> f</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> arr<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span>f<span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">map</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> x</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> Mapper<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span>x<span class="token" style="color:#586e75">,</span> f<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>

<span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span><span class="token parameter">x</span> <span class="token" style="color:#cb4b16">=&gt;</span> x <span class="token" style="color:#cb4b16">+</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#268bd2">1</span><span class="token" style="color:#586e75">,</span><span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">,</span><span class="token" style="color:#268bd2">3</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// [3,4,5]</span>
</code></pre><p>Here we can see protomorphism in action with our Mapper protocol from the last post. This actually isn&#x27;t too different from the code we would write in our imaginary language. What we see here is basically all of protomorphism, it is a simple library that does one thing. In fact, it is only 31 lines of code. But fewer lines doesn&#x27;t mean less powerful. As promised in our last post, we are going to create our own lodash like library, but our library, using the power of protocols, will work whether we use normal Javascript Arrays, ImmutableJs Lists, or any type that implements our protocol.</p><h2>Sequence Protocol</h2><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">const</span> Sequence <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#b58900">protocol</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">{</span>
  <span class="token function-variable" style="color:#b58900">cons</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll<span class="token" style="color:#586e75">,</span> elem</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#93a1a1">// prepends elem to coll</span>
  <span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">,</span>
  <span class="token function-variable" style="color:#b58900">first</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#93a1a1">// gets first element of coll</span>
  <span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">,</span>
  <span class="token function-variable" style="color:#b58900">rest</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#93a1a1">// returns all but first element</span>
  <span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">,</span>
  <span class="token function-variable" style="color:#b58900">isEmpty</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#93a1a1">// returns true if empty</span>
  <span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">,</span>
  <span class="token function-variable" style="color:#b58900">empty</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#93a1a1">// given a coll, it will return</span>
    <span class="token" style="color:#93a1a1">// an empty collection of the same type</span>
  <span class="token" style="color:#586e75">}</span>
<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>Here is our Sequence protocol from which we will build all our lodash like functions. It is a simple protocol, with only five methods, each of which is fairly straightforward. Using these we can start building up more and more useful functions. Let&#x27;s start off with some very simple ones.</p><h2>Examples</h2><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">const</span> cons <span class="token" style="color:#cb4b16">=</span> Sequence<span class="token" style="color:#586e75">.</span>cons
<span class="token" style="color:#859900">const</span> first <span class="token" style="color:#cb4b16">=</span> Sequence<span class="token" style="color:#586e75">.</span>first
<span class="token" style="color:#859900">const</span> rest <span class="token" style="color:#cb4b16">=</span> Sequence<span class="token" style="color:#586e75">.</span>rest
<span class="token" style="color:#859900">const</span> isEmpty <span class="token" style="color:#cb4b16">=</span> Sequence<span class="token" style="color:#586e75">.</span>isEmpty
<span class="token" style="color:#859900">const</span> empty <span class="token" style="color:#cb4b16">=</span> Sequence<span class="token" style="color:#586e75">.</span>empty

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">second</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">first</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">rest</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">ffirst</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#b58900">first</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">first</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">last</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
  <span class="token" style="color:#859900">if</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">isEmpty</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#859900">return</span> <span class="token" style="color:#859900">undefined</span>
  <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">else</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">isEmpty</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">rest</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#859900">return</span> <span class="token" style="color:#b58900">first</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">else</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#859900">return</span> <span class="token" style="color:#b58900">last</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">rest</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
  <span class="token" style="color:#586e75">}</span>
<span class="token" style="color:#586e75">}</span>
</code></pre><p>We start off with simple aliases to our Sequence functions we need to use. This is purely for convenience&#x27;s sake and not necessary. Next we implement two very simple functions, <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">second</code> and<code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap"> ffirst</code>. Second does what it says, it gives of the second element of a collection; ffirst gives us the first of the first element of the collection. Below should illustrate the difference clearly.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">const</span> coll <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">[</span><span class="token" style="color:#268bd2">1</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#268bd2">3</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">]</span>
<span class="token" style="color:#b58900">second</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// [2]</span>
<span class="token" style="color:#b58900">ffirst</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// 1</span>
</code></pre><p>The <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">last</code> function is a little more involved, but if you are familiar with recursion it is very simple. If we are passed an empty collection, there is no last, so we return undefined. If we are passed a collection with only one thing in it, we return that thing. Otherwise, we take one item off the collection and find the last of that collection.</p><p>One thing to note is that these functions are perfectly comprehensible and sensible and yet we have not mentioned at all what data structure these functions are for. As far as our code is concerned, it doesn&#x27;t matter if this is an array, an immutable list, or any other type. All that matters for the functions above is that the data structure implements the Sequence protocol.</p><h2>Implementations</h2><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">Sequence<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">implementation</span><span class="token" style="color:#586e75">(</span>Immutable<span class="token" style="color:#586e75">.</span>List<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">{</span>
    <span class="token function-variable" style="color:#b58900">cons</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll<span class="token" style="color:#586e75">,</span> elem</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> coll<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">unshift</span><span class="token" style="color:#586e75">(</span>elem<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span>
    <span class="token function-variable" style="color:#b58900">empty</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> Immutable<span class="token" style="color:#586e75">.</span>List<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">of</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span>
    <span class="token function-variable" style="color:#b58900">first</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> coll<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">first</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span>
    <span class="token function-variable" style="color:#b58900">rest</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> coll<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">rest</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span>
    <span class="token function-variable" style="color:#b58900">isEmpty</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> coll<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">isEmpty</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span>
<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>
</code></pre><p>Above is our implementation of the sequence protocol for ImmutableJs Lists. Our Sequence protocol assumes that each of our functions has no side effects, so ImmutableJs is a perfect fit here. In fact, there are methods that correspond exactly to the methods on our the Sequence protocol. Now we can use the functions we wrote on ImmutableJs Lists.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">const</span> coll <span class="token" style="color:#cb4b16">=</span> Immutable<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">fromJS</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">[</span><span class="token" style="color:#268bd2">1</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#268bd2">3</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span>
<span class="token" style="color:#b58900">second</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// List [2]</span>
<span class="token" style="color:#b58900">ffirst</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// 1</span>
</code></pre><p>This works exactly the same as the example above. In our first example, we just assumed we had an implementation of Sequence for Javascript Arrays, let&#x27;s go ahead and write one now.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">Seq<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">implementation</span><span class="token" style="color:#586e75">(</span>Array<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#586e75">{</span>
    <span class="token function-variable" style="color:#b58900">cons</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll<span class="token" style="color:#586e75">,</span> elem</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
        coll <span class="token" style="color:#cb4b16">=</span> coll<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">slice</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// copy</span>
        coll<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">unshift</span><span class="token" style="color:#586e75">(</span>elem<span class="token" style="color:#586e75">)</span>
        <span class="token" style="color:#859900">return</span> coll
    <span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">,</span>
    <span class="token function-variable" style="color:#b58900">empty</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">,</span>
    <span class="token function-variable" style="color:#b58900">first</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> coll<span class="token" style="color:#586e75">[</span><span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">,</span>
    <span class="token function-variable" style="color:#b58900">rest</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
        coll <span class="token" style="color:#cb4b16">=</span> coll<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">slice</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#93a1a1">// copy</span>
        coll<span class="token" style="color:#586e75">.</span><span class="token" style="color:#b58900">shift</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#268bd2">0</span><span class="token" style="color:#586e75">)</span>
        <span class="token" style="color:#859900">return</span> coll
    <span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">,</span>
    <span class="token function-variable" style="color:#b58900">isEmpty</span><span class="token" style="color:#586e75">:</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> coll<span class="token" style="color:#586e75">.</span>length <span class="token" style="color:#cb4b16">==</span> <span class="token" style="color:#268bd2">0</span>
<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>
</code></pre><p>The definition for Arrays is a tad bit uglier. This is due mainly to the fact that our protocol&#x27;s methods are assumed to be side-effect free, whereas Arrays methods mutate. So in order to do cons and rest, we must copy the array. Now, that we have defined the Sequence protocol for Arrays, all functions that just use protocol methods will work with Arrays.</p><h1>More Functions</h1><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">map</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#859900">if</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">isEmpty</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
        <span class="token" style="color:#859900">return</span> coll<span class="token" style="color:#586e75">;</span>
    <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">else</span> <span class="token" style="color:#586e75">{</span>
        <span class="token" style="color:#859900">return</span> <span class="token" style="color:#b58900">cons</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">first</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">map</span><span class="token" style="color:#586e75">(</span>f<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">rest</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>
    <span class="token" style="color:#586e75">}</span>
<span class="token" style="color:#586e75">}</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">filter</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">pred<span class="token" style="color:#586e75">,</span> coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#859900">if</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">isEmpty</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
        <span class="token" style="color:#859900">return</span> coll<span class="token" style="color:#586e75">;</span>
    <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">else</span> <span class="token" style="color:#859900">if</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">pred</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">first</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
        <span class="token" style="color:#859900">return</span> <span class="token" style="color:#b58900">cons</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">first</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">filter</span><span class="token" style="color:#586e75">(</span>pred<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">rest</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>
    <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">else</span> <span class="token" style="color:#586e75">{</span>
        <span class="token" style="color:#859900">return</span> <span class="token" style="color:#b58900">filter</span><span class="token" style="color:#586e75">(</span>pred<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">rest</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">;</span>
    <span class="token" style="color:#586e75">}</span>
<span class="token" style="color:#586e75">}</span>

<span class="token" style="color:#859900">const</span> <span class="token function-variable" style="color:#b58900">reduce</span> <span class="token" style="color:#cb4b16">=</span> <span class="token" style="color:#586e75">(</span><span class="token parameter">f<span class="token" style="color:#586e75">,</span> init<span class="token" style="color:#586e75">,</span> coll</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">=&gt;</span> <span class="token" style="color:#586e75">{</span>
    <span class="token" style="color:#859900">if</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">isEmpty</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#586e75">{</span>
        <span class="token" style="color:#859900">return</span> init<span class="token" style="color:#586e75">;</span>
    <span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">else</span> <span class="token" style="color:#586e75">{</span>
        <span class="token" style="color:#859900">return</span> <span class="token" style="color:#b58900">f</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#b58900">reduce</span><span class="token" style="color:#586e75">(</span>f<span class="token" style="color:#586e75">,</span> init<span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">rest</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">,</span> <span class="token" style="color:#b58900">first</span><span class="token" style="color:#586e75">(</span>coll<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
    <span class="token" style="color:#586e75">}</span>
<span class="token" style="color:#586e75">}</span>
</code></pre><p>Here we have the three powerhouse lodash functions. By showing that we can implement these, it becomes easy to see how we can begin to implement all the functionality that lodash supports, but without depending on a concrete implementation.</p><h2>Conclusion</h2><p>Protocols give us the ability to reason at a higher level of abstractions. They provide us with a way to extend functionality to new code that we never planned for. This level of programming allows our code to be clear, yet powerful. In our next post, we are going to explore a similar, yet slightly different way to provide flexibility and extensibility, multi-methods.</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/protomorphism","query":{},"buildId":"NkSpooCu6BjZSpPPrzhqj","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>