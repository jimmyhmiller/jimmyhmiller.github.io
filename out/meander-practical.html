<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="data:;base64,iVBORw0KGgo="/><meta name="author" content="Jimmy Miller"/><link rel="alternate" type="application/rss+xml" title="jimmyhmiller.github.io" href="feed.xml"/><title>Meander for Practical Data Transformation</title><meta name="next-head-count" content="6"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-779b41245c009d2a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9a4e0bcfd9f9bf48.js" defer=""></script><script src="/_next/static/chunks/346-54adb587a188464b.js" defer=""></script><script src="/_next/static/chunks/854-585071c317c86ef6.js" defer=""></script><script src="/_next/static/chunks/pages/meander-practical-d06a09195078fc52.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_buildManifest.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_ssgManifest.js" defer=""></script><script src="/_next/static/NkSpooCu6BjZSpPPrzhqj/_middlewareManifest.js" defer=""></script><style id="__jsx-4dc580444c2ee173">body{font-family:helvetica,sans-serif;color:#333;line-height:1.5}a{color:#333}</style></head><body><div id="__next" data-reactroot=""><div style="margin:0 auto;max-width:700px"><div style="position:relative"><div style="position:absolute;right:0;top:0"><a style="text-decoration:none" href="/"><h1 style="color:#999">Jimmy Miller</h1></a></div></div><div style="padding-top:70px"><h1>Meander for Practical Data Transformation</h1><p>As Clojure programmers we love data. We believe that, at its core, programming is just data manipulation. To that end, Clojure provides fantastic data literals for its immutable data structures. Moreover core provides tons of functions for the manipulation of data. But as our data grows more complex, things become difficult. Our beautiful declarative data transformation pipeline becomes a nested mess. We wind up, yet again, playing computer in our heads.</p><p>In this tutorial, we are going to build up slowly to understand how <a href="https://github.com/noprompt/meander/">Meander</a> <!-- -->can be used to solve practical data transformation problems. We will start with simple examples and move to more complicated ones, hopefully choosing problems that reflect the sorts of menial data transformation tasks we all encounter in our day jobs. Let&#x27;s start with some vanilla Clojure code.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">def</span> person
  <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">&quot;jimmy&quot;</span>
   <span class="token" style="color:#cb4b16">:preferred-address</span>
   <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;123 street ave&quot;</span>
    <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 2&quot;</span>
    <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Townville&quot;</span>
    <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;IN&quot;</span>
    <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;46203&quot;</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> reformat-preferred-address <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">let</span> <span class="token" style="color:#586e75">[</span>address <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:preferred-address</span> person<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">]</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:line1</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:address1</span> address<span class="token" style="color:#586e75">)</span>
               <span class="token" style="color:#cb4b16">:line2</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:address2</span> address<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span>
     <span class="token" style="color:#cb4b16">:city-info</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:city</span> address<span class="token" style="color:#586e75">)</span>
                 <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:state</span> address<span class="token" style="color:#586e75">)</span>
                 <span class="token" style="color:#cb4b16">:zipcode</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:zip</span> address<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>Here we have a pretty decent Clojure function that converts between two different address formats. This sort of code is fairly common when we need to convert from the data requirements of one system to another. Honestly, with this simple example, the code is fairly straightforward. Our data requirements are simple and so our code isn&#x27;t difficult. Let&#x27;s look at how to accomplish this same task in Meander.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span>require &#x27;<span class="token" style="color:#586e75">[</span>meander.epsilon <span class="token" style="color:#cb4b16">:as</span> m<span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> reformat-preferred-address <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span>m/match person
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:preferred-address</span>
     <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">?address1</span>
      <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">?address2</span>
      <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">?city</span>
      <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">?state</span>
      <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">?zip</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span>
    
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:line1</span> <span class="token" style="color:#2aa198">?address1</span>
               <span class="token" style="color:#cb4b16">:line2</span> <span class="token" style="color:#2aa198">?address2</span><span class="token" style="color:#586e75">}</span>
     <span class="token" style="color:#cb4b16">:city-info</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">?city</span>
                 <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">?state</span>
                 <span class="token" style="color:#cb4b16">:zipcode</span> <span class="token" style="color:#2aa198">?zip</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>Here is code that does the same thing written with Meander. One obvious thing to note is that the Meander version is much longer. Judging code based on the number of lines is not something we are going to do.</p><p>Let&#x27;s explain what is going on. First, we are using the Meander&#x27;s<!-- --> <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">match</code> feature. <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">match</code> takes the thing that we are matching on (<code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">person</code>), a pattern to try to match, and the output. Our pattern here is in the exact shape of the person map we passed in. In order to extract out pieces of this map, we use logic variables (<code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">?address1</code>, <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">?address2</code>, etc). Logic variables are just symbols that start with <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">?</code>. We can assign values in our data to any logic variables we&#x27;d like and then use those logic variables in our output. One thing I love about this simple Meander example is that you can see the exact shape of the input immediately.</p><h2>Making Our Example Harder</h2><p>This example while somewhat realistic is very limited. While I like the fact that Meander&#x27;s match shows us the shape of our data, for simple examples like this, Clojure does pretty well. Let&#x27;s make things harder.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">def</span> person
  <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">&quot;jimmy&quot;</span>
   <span class="token" style="color:#cb4b16">:preferred-address</span>
   <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;123 street ave&quot;</span>
    <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 2&quot;</span>
    <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Townville&quot;</span>
    <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;IN&quot;</span>
    <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;46203&quot;</span><span class="token" style="color:#586e75">}</span>
   <span class="token" style="color:#cb4b16">:other-addresses</span> 
   <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;432 street ave&quot;</span>
     <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 7&quot;</span>
     <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Cityvillage&quot;</span>
     <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;New York&quot;</span>
     <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;12345&quot;</span><span class="token" style="color:#586e75">}</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;534 street ave&quot;</span>
     <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 5&quot;</span>
     <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Township&quot;</span>
     <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;IN&quot;</span>
     <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;46203&quot;</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>In the example above we left out some things. A person has a preferred address, but they also have other addresses. We have a few different things we want to do with this data. First, we want to find all the distinct zip codes that a person has.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> distinct-zip-codes <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">let</span> <span class="token" style="color:#586e75">[</span>preferred-address-zip <span class="token" style="color:#586e75">(</span>get-in person <span class="token" style="color:#586e75">[</span><span class="token" style="color:#cb4b16">:preferred-address</span> <span class="token" style="color:#cb4b16">:zip</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span>
        other-zips <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">map</span> <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:other-addresses</span> person<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">]</span>
    <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">cons</span> preferred-address-zip other-zips<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>Here is some pretty straightforward Clojure code for doing exactly that. I&#x27;m sure some people could have minor quibbles about how this is written, but I doubt other solutions would be much different. One thing to note here is that we have lost a little bit of the structure of our input data. We could maybe change that up a bit. Maybe using destructuring is the right approach? Regardless, this is a simple and reasonable Clojure function. Now, let&#x27;s look at the Meander version.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> distinct-zip-codes <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span>m/match person
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:preferred-address</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">!zips</span><span class="token" style="color:#586e75">}</span>
     <span class="token" style="color:#cb4b16">:other-addresses</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">!zips</span><span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">..</span>.<span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">}</span>
    <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#2aa198">!zips</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>Here is the exact same function, but we&#x27;ve introduced two new concepts. The first one is memory variables, in this case <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">!zip</code>. Memory variables start with <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">!</code> and remember all the values they match with. The next concept is the zero or more operator (<code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">…</code>). The zero or more operator says to repeat the pattern to its left zero or more times. In this case <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">{:zip !zips}</code>. Using these two, we can declaratively gather up all the zip codes in this data structure.</p><h3>Minor Modifications</h3><p>What happens if one of our zip codes is nil? Well for both of our functions, nil gets returned in the output. That is probably not what we want. Let&#x27;s fix that in both versions.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> distinct-zip-codes <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">let</span> <span class="token" style="color:#586e75">[</span>preferred-address-zip <span class="token" style="color:#586e75">(</span>get-in person <span class="token" style="color:#586e75">[</span><span class="token" style="color:#cb4b16">:preferred-address</span> <span class="token" style="color:#cb4b16">:zip</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span>
        other-zips <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">map</span> <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:other-addresses</span> person<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">]</span>
    <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">filter</span> some? <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">cons</span> preferred-address-zip other-zips<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> distinct-zip-codes <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span>m/match person
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:preferred-address</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#586e75">(</span>m/<span class="token" style="color:#859900">or</span> <span class="token" style="color:#268bd2">nil</span> <span class="token" style="color:#2aa198">!zips</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span>
     <span class="token" style="color:#cb4b16">:other-addresses</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#586e75">(</span>m/<span class="token" style="color:#859900">or</span> <span class="token" style="color:#268bd2">nil</span> <span class="token" style="color:#2aa198">!zips</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">..</span>.<span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">}</span>
    <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#2aa198">!zips</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>These two functions aren&#x27;t that different. In Meander we could have used<!-- --> <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">filter</code> in the exact same way if we wanted. But it&#x27;s nice that we can set these conditions on the input, which is really more closely stating our intent. Here we used <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">or</code> a short-circuiting operator which says that we should match one of these patterns. Our first pattern is just the literal nil. If it is nil, the pattern will match, but it won&#x27;t be saved anywhere. If the value isn&#x27;t nil, it will be saved in our memory variable <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">!zips</code>. Before we move on to more complex examples, let&#x27;s consider one more modification. This time we want a distinct list of non-nil zips and cities output in a map like this <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">{:zips [] :cities []}</code>.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> distinct-zips-and-cities <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">let</span> <span class="token" style="color:#586e75">[</span>preferred-address-zip <span class="token" style="color:#586e75">(</span>get-in person <span class="token" style="color:#586e75">[</span><span class="token" style="color:#cb4b16">:preferred-address</span> <span class="token" style="color:#cb4b16">:zip</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span>
        preferred-address-city <span class="token" style="color:#586e75">(</span>get-in person <span class="token" style="color:#586e75">[</span><span class="token" style="color:#cb4b16">:preferred-address</span> <span class="token" style="color:#cb4b16">:city</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span>
        other-zips <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">map</span> <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:other-addresses</span> person<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
        other-cities <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">map</span> <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:other-addresses</span> person<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">]</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zips</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">filter</span> some? <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">cons</span> preferred-address-zip other-zips<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
     <span class="token" style="color:#cb4b16">:cities</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">filter</span> some? <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">cons</span> preferred-address-city other-cities<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> distinct-zips-and-cities <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span>m/match person
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:preferred-address</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#586e75">(</span>m/<span class="token" style="color:#859900">or</span> <span class="token" style="color:#268bd2">nil</span> <span class="token" style="color:#2aa198">!zips</span><span class="token" style="color:#586e75">)</span>
                         <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#586e75">(</span>m/<span class="token" style="color:#859900">or</span> <span class="token" style="color:#268bd2">nil</span> <span class="token" style="color:#2aa198">!cities</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span>
     <span class="token" style="color:#cb4b16">:other-addresses</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#586e75">(</span>m/<span class="token" style="color:#859900">or</span> <span class="token" style="color:#268bd2">nil</span> <span class="token" style="color:#2aa198">!zips</span><span class="token" style="color:#586e75">)</span>
                        <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#586e75">(</span>m/<span class="token" style="color:#859900">or</span> <span class="token" style="color:#268bd2">nil</span> <span class="token" style="color:#2aa198">!cities</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span> <span class="token" style="color:#859900">..</span>.<span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">}</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zips</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#2aa198">!zips</span><span class="token" style="color:#586e75">)</span>
     <span class="token" style="color:#cb4b16">:cities</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#2aa198">!cities</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>With both of these examples, I extended them in the most obvious way I could think of. I think the Meander held up pretty well, but I wouldn&#x27;t have written the plain Clojure function that way. Here&#x27;s what I probably would have done instead.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> distinct-zips-and-cities <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">let</span> <span class="token" style="color:#586e75">[</span>addresses <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">cons</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:preferred-address</span> person<span class="token" style="color:#586e75">)</span> 
                        <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:other-addresses</span> person<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">]</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zips</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">filter</span> some? <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">map</span> <span class="token" style="color:#cb4b16">:zip</span> addresses<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
     <span class="token" style="color:#cb4b16">:cities</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">filter</span> some? <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">distinct</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">map</span> <span class="token" style="color:#cb4b16">:city</span> addresses<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>I think this is a pretty good function. But what I find interesting is that I needed to refactor to get here. It took me a little bit to think this way. Ideally, small changes to output should not require us to restructure our code. In this case, the change is minor. But if we have to change our structure in such small cases, won&#x27;t we have to change it even more in larger cases?</p><h2>Searching with Meander</h2><p>All our examples up until this point have had one answer. Yes, that answer might have been a collection, but there was only one way for our pattern to match. This isn&#x27;t always the case. To see an example of that, let&#x27;s write some functions using this data structure.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">def</span> people
  <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">&quot;jimmy&quot;</span>
    <span class="token" style="color:#cb4b16">:addresses</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;123 street ave&quot;</span>
                 <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 2&quot;</span>
                 <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Townville&quot;</span>
                 <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;IN&quot;</span>
                 <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;46203&quot;</span>
                 <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">true</span><span class="token" style="color:#586e75">}</span>
                <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;534 street ave&quot;</span><span class="token" style="color:#586e75">,</span>
                 <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 5&quot;</span><span class="token" style="color:#586e75">,</span>
                 <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Township&quot;</span><span class="token" style="color:#586e75">,</span>
                 <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;IN&quot;</span><span class="token" style="color:#586e75">,</span>
                 <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;46203&quot;</span>
                 <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">false</span><span class="token" style="color:#586e75">}</span>
                <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;543 Other St&quot;</span><span class="token" style="color:#586e75">,</span>
                 <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 50&quot;</span><span class="token" style="color:#586e75">,</span>
                 <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Town&quot;</span><span class="token" style="color:#586e75">,</span>
                 <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;CA&quot;</span><span class="token" style="color:#586e75">,</span>
                 <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;86753&quot;</span>
                 <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">false</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">}</span>
   <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">&quot;joel&quot;</span>
    <span class="token" style="color:#cb4b16">:addresses</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;2026 park ave&quot;</span>
                 <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 200&quot;</span>
                 <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Town&quot;</span>
                 <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;CA&quot;</span>
                 <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;86753&quot;</span>
                 <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">true</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>I apologize for the amount of room this takes up on the screen, but real-world examples are much larger. I want to try and make something that approaches realistic and to do that our input needs to be a bit bigger. Okay, so what we want to do now is given a zip code, find all people that have an address with that zip code, and for each of the addresses that match that zip code, return a map of<code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">{:name &lt;name&gt; :address &lt;address&gt;}</code>. So in this case, if we asked for zip <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">86753</code> we should get the following response:</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">&quot;jimmy&quot;</span><span class="token" style="color:#586e75">,</span>
  <span class="token" style="color:#cb4b16">:address</span>
  <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;543 Other St&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 50&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Town&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;CA&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;86753&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">false</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span>
 <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">&quot;joel&quot;</span><span class="token" style="color:#586e75">,</span>
  <span class="token" style="color:#cb4b16">:address</span>
  <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;2026 park ave&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 200&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Town&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;CA&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;86753&quot;</span><span class="token" style="color:#586e75">,</span>
   <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">true</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>Okay let&#x27;s start with the vanilla Clojure example.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> find-people-with-zip <span class="token" style="color:#586e75">[</span>people zip<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">for</span> <span class="token" style="color:#586e75">[</span>person people
        address <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:addresses</span> person<span class="token" style="color:#586e75">)</span>
        <span class="token" style="color:#cb4b16">:when</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">=</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:zip</span> address<span class="token" style="color:#586e75">)</span> zip<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">]</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:name</span> person<span class="token" style="color:#586e75">)</span>
     <span class="token" style="color:#cb4b16">:address</span> address<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>This code might not be very idiomatic. I almost never use <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">for</code> <!-- -->in actual code. But honestly, this was the most succinct way I could think to write it. We could also have written something like this:</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> person-with-address-comb <span class="token" style="color:#586e75">[</span>person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">map</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">fn</span> <span class="token" style="color:#586e75">[</span>address<span class="token" style="color:#586e75">]</span>
         <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:name</span> person<span class="token" style="color:#586e75">)</span>
          <span class="token" style="color:#cb4b16">:address</span> address<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>
       <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:addresses</span> person<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> find-people-with-zip <span class="token" style="color:#586e75">[</span>people zip<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">-&gt;&gt;</span> people
       <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">mapcat</span> person-with-address-comb<span class="token" style="color:#586e75">)</span>
       <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">filter</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">comp</span> #<span class="token" style="color:#586e75">{</span>zip<span class="token" style="color:#586e75">}</span> <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#cb4b16">:address</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>It seems like there is a better way I&#x27;m overlooking. But regardless I think any of these solutions will be a tiny bit complicated. We&#x27;ve lost the shape of the input data. We have some imperative stuff going on here. Let&#x27;s contrast this with the Meander implementation.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> find-people-with-zip <span class="token" style="color:#586e75">[</span>people zip<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span>m/search people
    <span class="token" style="color:#586e75">(</span>m/scan <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">?name</span>
             <span class="token" style="color:#cb4b16">:addresses</span> <span class="token" style="color:#586e75">(</span>scan <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> ~zip <span class="token" style="color:#cb4b16">:as</span> <span class="token" style="color:#2aa198">?address</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">?name</span>
     <span class="token" style="color:#cb4b16">:address</span> <span class="token" style="color:#2aa198">?address</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>This is actually incredibly straight forward even if unfamiliar. We are now using <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">search</code> to find multiple answers. Also note<!-- --> <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">~zip</code>. The <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">~</code> here let&#x27;s us splice in variables that are in scope. And finally, we can name our whole map using the<!-- --> <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">:as</code> pattern. This code reads like what we conceptually want to do, scan people&#x27;s addresses looking for zips that match the one passed in. We do not have to think at all about how this code runs.</p><h2>One Final Example</h2><p>For our final example of how Meander can be used to perform data manipulation, will show one feature of logic variables that we have left off so far. To do so we need some more complex data.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">def</span> data
  <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:people</span> 
   <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">&quot;jimmy&quot;</span> <span class="token" style="color:#cb4b16">:id</span> <span class="token" style="color:#268bd2">1</span><span class="token" style="color:#586e75">}</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">&quot;joel&quot;</span> <span class="token" style="color:#cb4b16">:id</span> <span class="token" style="color:#268bd2">2</span><span class="token" style="color:#586e75">}</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">&quot;tim&quot;</span> <span class="token" style="color:#cb4b16">:id</span> <span class="token" style="color:#268bd2">3</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span>
   <span class="token" style="color:#cb4b16">:addresses</span>
   <span class="token" style="color:#586e75">{</span><span class="token" style="color:#268bd2">1</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;123 street ave&quot;</span>
        <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 2&quot;</span>
        <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Townville&quot;</span>
        <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;IN&quot;</span>
        <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;46203&quot;</span>
        <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">true</span><span class="token" style="color:#586e75">}</span>
       <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;534 street ave&quot;</span><span class="token" style="color:#586e75">,</span>
        <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 5&quot;</span><span class="token" style="color:#586e75">,</span>
        <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Township&quot;</span><span class="token" style="color:#586e75">,</span>
        <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;IN&quot;</span><span class="token" style="color:#586e75">,</span>
        <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;46203&quot;</span>
        <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">false</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span>
    <span class="token" style="color:#268bd2">2</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;2026 park ave&quot;</span>
        <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 200&quot;</span>
        <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;Town&quot;</span>
        <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;CA&quot;</span>
        <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;86753&quot;</span>
        <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">true</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span>
    <span class="token" style="color:#268bd2">3</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:address1</span> <span class="token" style="color:#2aa198">&quot;1448 street st&quot;</span>
        <span class="token" style="color:#cb4b16">:address2</span> <span class="token" style="color:#2aa198">&quot;apt 1&quot;</span>
        <span class="token" style="color:#cb4b16">:city</span> <span class="token" style="color:#2aa198">&quot;City&quot;</span>
        <span class="token" style="color:#cb4b16">:state</span> <span class="token" style="color:#2aa198">&quot;WA&quot;</span>
        <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;92456&quot;</span>
        <span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">true</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">}</span>
   <span class="token" style="color:#cb4b16">:visits</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#268bd2">1</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:date</span> <span class="token" style="color:#2aa198">&quot;12-31-1900&quot;</span>
                <span class="token" style="color:#cb4b16">:geo-location</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;46203&quot;</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span>
            <span class="token" style="color:#268bd2">2</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:date</span> <span class="token" style="color:#2aa198">&quot;1-1-1970&quot;</span>
                <span class="token" style="color:#cb4b16">:geo-location</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;12345&quot;</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span>
               <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:date</span> <span class="token" style="color:#2aa198">&quot;1-1-1970&quot;</span>
                <span class="token" style="color:#cb4b16">:geo-location</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;86753&quot;</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span>
            <span class="token" style="color:#268bd2">3</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:date</span> <span class="token" style="color:#2aa198">&quot;4-4-4444&quot;</span>
                <span class="token" style="color:#cb4b16">:geo-location</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;54221&quot;</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span>
               <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:date</span> <span class="token" style="color:#2aa198">&quot;4-4-4444&quot;</span>
                <span class="token" style="color:#cb4b16">:geo-location</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">&quot;92456&quot;</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>Here we have some much more realistic data than anything we&#x27;ve seen before. We have a map with three top-level keys. These represent data we have gathered from various sources. The first key <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">:people</code> is our collection of people with names and ids. The next is the<!-- --> <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">:addresses</code> of these people, indexed by id for efficient lookup. And finally we have <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">:visits</code>, this represents the dates that the users visited our site, again indexed by user-id.</p><p>Here&#x27;s the mock scenario, we&#x27;ve seen suspicious activity on our site and we aren&#x27;t quite sure how to narrow it down. We are going to start our investigation by finding any users who had visits that were not in the same zip as their preferred address. Because of the nature of our application, we happen to know that it is typically used at the preferred location. Once we know the users affected, we need to return their name, id, the date of access, and the zip code that didn&#x27;t match. But I want to show that despite this somewhat complicated scenario, we can easily express this using Meander. Before we get there, the Clojure implementation.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">
<span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> find-non-matching-visits <span class="token" style="color:#586e75">[</span>address visits<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">filter</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">comp</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">complement</span> #<span class="token" style="color:#586e75">{</span><span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:zip</span> address<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#cb4b16">:geo-location</span><span class="token" style="color:#586e75">)</span> visits<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> find-bad-visits-for-person <span class="token" style="color:#586e75">[</span>addresses visits person<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">let</span> <span class="token" style="color:#586e75">[</span>preferred-address <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">first</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">filter</span> <span class="token" style="color:#cb4b16">:preferred</span> addresses<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
        non-matching <span class="token" style="color:#586e75">(</span>find-non-matching-visits preferred-address visits<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">]</span>
    <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">map</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">fn</span> <span class="token" style="color:#586e75">[</span>visit<span class="token" style="color:#586e75">]</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:name</span> person<span class="token" style="color:#586e75">)</span>
                      <span class="token" style="color:#cb4b16">:id</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:id</span> person<span class="token" style="color:#586e75">)</span>
                      <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#586e75">(</span>get-in visit <span class="token" style="color:#586e75">[</span><span class="token" style="color:#cb4b16">:geo-location</span> <span class="token" style="color:#cb4b16">:zip</span><span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">)</span>
                      <span class="token" style="color:#cb4b16">:date</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#cb4b16">:date</span> visit<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>
        non-matching<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>

<span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> find-potential-bad-visits <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:keys</span> <span class="token" style="color:#586e75">[</span>addresses visits people<span class="token" style="color:#586e75">]</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">mapcat</span> <span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">fn</span> <span class="token" style="color:#586e75">[</span><span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:keys</span> <span class="token" style="color:#586e75">[</span>id<span class="token" style="color:#586e75">]</span> <span class="token" style="color:#cb4b16">:as</span> person<span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">]</span> 
            <span class="token" style="color:#586e75">(</span>find-bad-visits-for-person 
             <span class="token" style="color:#586e75">(</span>addresses id<span class="token" style="color:#586e75">)</span>
             <span class="token" style="color:#586e75">(</span>visits id<span class="token" style="color:#586e75">)</span> 
             person<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
          people<span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>I really wanted to come up with a better implementation. <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">for</code> <!-- -->might have been useful here. If any reader has a better implementation, I&#x27;m happy to replace this one. But honestly, I think no matter what version we went with, it is going to have the features that make this one less than desirable. Just look at how much of this code is about telling the computer what to do. Let&#x27;s look at the Meander version now.</p><pre style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background-color:#fff"><code style="color:#657b83;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#586e75">(</span><span class="token" style="color:#859900">defn</span> find-potential-bad-visits <span class="token" style="color:#586e75">[</span>data<span class="token" style="color:#586e75">]</span>
  <span class="token" style="color:#586e75">(</span>m/search data
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:people</span> <span class="token" style="color:#586e75">(</span>m/scan <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:id</span> <span class="token" style="color:#2aa198">?id</span> <span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">?name</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span>
     <span class="token" style="color:#cb4b16">:addresses</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#2aa198">?id</span> <span class="token" style="color:#586e75">(</span>m/scan <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:preferred</span> <span class="token" style="color:#268bd2">true</span> <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">?zip</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span>
     <span class="token" style="color:#cb4b16">:visits</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#2aa198">?id</span> <span class="token" style="color:#586e75">(</span>m/scan <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:geo-location</span> <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#586e75">(</span>m/<span class="token" style="color:#859900">and</span> <span class="token" style="color:#586e75">(</span>m/<span class="token" style="color:#859900">not</span> <span class="token" style="color:#2aa198">?zip</span><span class="token" style="color:#586e75">)</span> <span class="token" style="color:#2aa198">?bad-zip</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span>
                           <span class="token" style="color:#cb4b16">:date</span> <span class="token" style="color:#2aa198">?date</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">}</span>
    <span class="token" style="color:#586e75">{</span><span class="token" style="color:#cb4b16">:name</span> <span class="token" style="color:#2aa198">?name</span>
     <span class="token" style="color:#cb4b16">:id</span> <span class="token" style="color:#2aa198">?id</span>
     <span class="token" style="color:#cb4b16">:zip</span> <span class="token" style="color:#2aa198">?bad-zip</span>
     <span class="token" style="color:#cb4b16">:date</span> <span class="token" style="color:#2aa198">?date</span><span class="token" style="color:#586e75">}</span><span class="token" style="color:#586e75">)</span><span class="token" style="color:#586e75">)</span>
</code></pre><p>This is where Meander shines. <code style="background-color:rgba(27,31,35,0.05);padding:0.2em 0.4em;border-radius:3px;font-family:Monaco, monospace;font-size:13px;white-space:nowrap">?id</code> is being used to join across data structures. We can now find an id in people and use that to index into other collections. This allows us to find out everything we need to know about a person easily. We can also search into any collection and match on data at any level. We don&#x27;t need to rely on pulling things out into a higher scope by using let bindings, making helper functions to work on sub-collections, or creating a series of transformations to get at the data we care about. Instead, we declare our data needs and the relationships that need to hold between them.</p><h2>Conclusion</h2><p>I hope that this has been a good introduction to how Meander can be used for practical data transformation problems. In many of these examples, the vanilla Clojure made for pretty good code. But as the data requirements become more complex, we need tools to handle these. While we may be able to accomplish any of these tasks, the understanding of the structure of our code becomes lost. Looking at the example above, we know so much about what the data coming in looks like. Our code mirrors precisely the shape of data we get in.</p><p>Now I do admit, my examples here are a bit contrived. But they are meant to be simple so we don&#x27;t focus on the examples and instead focus on the code. In coming posts, I will explore more directly various ways we can apply Meander for data transformation. Some ideas I have in mind are using Meander with honeysql to turn our data into sql, transforming a collection of data into hiccup for display as html, and using Meander to scrap the web. I&#x27;d also love to do more computer science examples. Using Meander to make a little lisp interpreter, a CEK machine, or basic arithmetic. And yet, Meander goes way beyond all of these things. Meander is about more than practical data manipulation. It is about a new way of programming, a new way of thinking about problems. Hopefully, this introduction will help you to dive in and try it yourself.</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/meander-practical","query":{},"buildId":"NkSpooCu6BjZSpPPrzhqj","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>